/* Copyright (C) 2009 - 2018 SEBLOD. All Rights Reserved. */
if("undefined"===typeof JCck.More){JCck.More={}};
!function(o){function d(t){var e,c,r=t.attr("id");return r?(e=r.lastIndexOf("_"),c=parseInt(r.slice(e+1))):c="",c}function f(t){var e=t.parent(),c=d(t);return 0==c?"first":c==e.children().length-1?"last":"middle"}function h(t){t.addClass("cck_form_group_x_last"),t.find(".cck_cgx_button").addClass("cck_cgx_button_last"),t.find(".cck_cgx_form").addClass("cck_cgx_form_last")}function m(t){t.removeClass("cck_form_group_x_last").find(".cck_cgx_button_last,.cck_cgx_form_last").removeClass("cck_cgx_button_last cck_cgx_form_last")}function u(t,e,c){var r=RegExp(c+"_0","g");return t=t.replace(r,c+"_"+e),r=RegExp(c+"[[]0","g"),t=t.replace(r,c+"["+e)}function i(t,e,c,r){var n,a=d(t)+"";a.length;switch(a=parseInt(a),e){case"add":n=a+1;break;case"del":n=a-1}t.attr("id",r+"_forms_"+c+"_"+n),t.find(".cck_cgx_button").attr("id",r+"button_"+c+"_"+n);var _,i=t.find(".cck_cgx_form");1<i.length?i.each(function(t){o(this).attr("id",r+"_form_"+c+"_"+n+"_"+t)}):i.attr("id",r+"_form_"+c+"_"+n),i.find('[name^="'+c+"["+a+']"]').each(function(t){_=o(this).attr("name").replace(c+"["+a,c+"["+n),o(this).attr("name",_)}),i.find('[id^="'+c+"_"+a+'_"]').each(function(t){_=o(this).attr("id").replace(c+"_"+a,c+"_"+n),o(this).attr("id",_)})}function g(t,e,c,r){for(var n=t.parent().children(":last"),a=t,_=!1;!_;)a.attr("id")==n.attr("id")?(i(a,e,c,r),_=!0):(i(a,e,c,r),a=a.next())}JCck.More.GroupX={add:function(t,e,c,r){var n,a,_,i=o("#"+r+"_sortable_"+t),s=i.children().length,l={color:"#d5eeff"};o("body").on("click",".cck_button_add_"+t,function(){if(o(this).hasClass("external")?elem=i.children("div").last():elem=o(this).closest('[id^="'+r+"_forms_"+t+'"]'),(a=elem.parent().children().length)<e){switch(_=f(elem),n=d(elem)+1,_){case"first":m(i.children("div:first")),elem.after(u(c,n,t)),o("#"+r+"_button_"+t+"_"+n).show("highlight",l,1e3),1==a?(m(elem),h(elem.next())):g(elem.next().next(),"add",t,r);break;case"last":m(i.children("div:last")),elem.after(u(c,n,t)),h(elem.next()),o("#"+r+"_button_"+t+"_"+s).show("highlight",l,1e3);break;case"middle":elem.after(u(c,n,t)),o("#"+r+"_button_"+t+"_"+n).show("highlight",l,1e3),g(elem.next().next(),"add",t,r)}i.find("script").each(function(){o(this).removeAttr("id")})}})},remove:function(c,r,n){var a,_,i;o("body").on("click",".cck_button_del_"+c,function(){var t,e=(a=o(this).closest('[id^="'+n+"_forms_"+c+'"]')).parent().children().length;if(r<e)switch(_=f(a),ind_elem=d(o(this).parent().parent()),"last"!=_&&g(a.next(),"del",c,n),a.toggle(),a.remove(),_){case"first":i=o("#"+n+"_sortable_"+c).children(":first"),(t=i).addClass("cck_form_group_x_first"),t.find(".cck_cgx_button").addClass("cck_cgx_button_first"),t.find(".cck_cgx_form").addClass("cck_cgx_form_first");break;case"last":h(i=o("#"+n+"_sortable_"+c).children(":last"))}o.isFunction(JCck.Core.recalc)&&JCck.Core.recalc()})}}}(jQuery);