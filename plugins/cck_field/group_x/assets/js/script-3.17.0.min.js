/* Copyright (C) 2009 - 2018 SEBLOD. All Rights Reserved. */
if("undefined"===typeof JCck.More){JCck.More={}};
!function(d){function o(t){var e,c,n=t.attr("id");return n?(e=n.lastIndexOf("_"),c=parseInt(n.slice(e+1))):c="",c}function f(t){var e=t.parent(),c=o(t);return 0==c?"first":c==e.children().length-1?"last":"middle"}function h(t){t.addClass("cck_form_group_x_last"),t.find(".cck_cgx_button").addClass("cck_cgx_button_last"),t.find(".cck_cgx_form").addClass("cck_cgx_form_last")}function u(t){t.removeClass("cck_form_group_x_last").find(".cck_cgx_button_last,.cck_cgx_form_last").removeClass("cck_cgx_button_last cck_cgx_form_last")}function m(t,e,c){var n=RegExp(c+"_0","g");return t=t.replace(n,c+"_"+e),n=RegExp(c+"[[]0","g"),t=t.replace(n,c+"["+e)}function i(t,e,c,n){var r,a=o(t)+"";a.length;switch(a=parseInt(a),e){case"add":r=a+1;break;case"del":r=a-1}t.attr("id",n+"_forms_"+c+"_"+r),t.find(".cck_cgx_button").attr("id",n+"_button_"+c+"_"+r);var _,i=t.find(".cck_cgx_form");1<i.length?i.each(function(t){d(this).attr("id",n+"_form_"+c+"_"+r+"_"+t)}):i.attr("id",n+"_form_"+c+"_"+r),i.find('[name^="'+c+"["+a+']"]').each(function(t){_=d(this).attr("name").replace(c+"["+a,c+"["+r),d(this).attr("name",_)}),i.find('[id^="'+c+"_"+a+'_"]').each(function(t){_=d(this).attr("id").replace(c+"_"+a,c+"_"+r),d(this).attr("id",_)}),i.find('[id^="'+n+"_"+c+"_"+a+'_"]').each(function(t){_=d(this).attr("id").replace(n+"_"+c+"_"+a,n+"_"+c+"_"+r),d(this).attr("id",_)}),t.find("script").each(function(t){var e=new RegExp(c+"_"+a,"g");d(this).text(d(this).text().replace(e,c+"_"+r))})}function g(t,e,c,n){for(var r=t.parent().children(":last"),a=t,_=!1;!_;)a.attr("id")==r.attr("id")?(i(a,e,c,n),_=!0):(i(a,e,c,n),a=a.next())}JCck.More.GroupX={add:function(t,e,c,n){var r,a,_,i=d("#"+n+"_sortable_"+t),s=i.children().length,l={color:"#d5eeff"};d("body").on("click",".cck_button_add_"+t,function(){if(d(this).hasClass("external")?elem=i.children("div").last():elem=d(this).closest('[id^="'+n+"_forms_"+t+'"]'),(a=elem.parent().children().length)<e)switch(_=f(elem),r=o(elem)+1,_){case"first":u(i.children("div:first")),elem.after(m(c,r,t)),d("#"+n+"_button_"+t+"_"+r).show("highlight",l,1e3),1==a?(u(elem),h(elem.next())):g(elem.next().next(),"add",t,n);break;case"last":u(i.children("div:last")),elem.after(m(c,r,t)),h(elem.next()),d("#"+n+"_button_"+t+"_"+s).show("highlight",l,1e3);break;case"middle":elem.after(m(c,r,t)),d("#"+n+"_button_"+t+"_"+r).show("highlight",l,1e3),g(elem.next().next(),"add",t,n)}})},remove:function(c,n,r){var a,_,i;d("body").on("click",".cck_button_del_"+c,function(){var t,e=(a=d(this).closest('[id^="'+r+"_forms_"+c+'"]')).parent().children().length;if(n<e)switch(_=f(a),ind_elem=o(d(this).parent().parent()),"last"!=_&&g(a.next(),"del",c,r),a.toggle(),a.remove(),_){case"first":i=d("#"+r+"_sortable_"+c).children(":first"),(t=i).addClass("cck_form_group_x_first"),t.find(".cck_cgx_button").addClass("cck_cgx_button_first"),t.find(".cck_cgx_form").addClass("cck_cgx_form_first");break;case"last":h(i=d("#"+r+"_sortable_"+c).children(":last"))}d.isFunction(JCck.Core.recalc)&&JCck.Core.recalc()})}}}(jQuery);