/* Copyright (C) 2009 - 2016 SEBLOD. All Rights Reserved. */
if("undefined"===typeof JCck)var JCck={};
!function(e){JCck.DevHelper={ajaxAddType:function(t,i){var a=e("#"+e("#client .selected").attr("for")).val(),o=e("#folder").val(),l=e("#myid").val();e.ajax({cache:!1,type:"POST",url:"index.php?option=com_cck&task=ajaxAddType&title="+t+"&folder_id="+o+"&client="+a+"&fields="+i+"&type_id="+l+"&format=raw",beforeSend:function(){},success:function(t){JCck.DevHelper.moveAcross("#sortable2");var i=jQuery.parseJSON(t),a=e('input:radio[name="positions"]:checked').attr("golast");a&&"undefined"!=a&&(e(a).before(i.html),e("#"+i.id).addClass("ui-selected"))},error:function(){}})},ajaxLayer:function(t,i,a,o,l){e.ajax({cache:!1,data:o,type:"GET",url:"index.php?option=com_cck&view="+t+"&layout="+i+"&format=raw",beforeSend:function(){"edit3"!=i&&"edit4"!=i&&e("#loading").html(JCck.Dev.spinner),e(a).html("")},success:function(t){"edit2"==i?(e("#loading").html(""),e(a).hide().html(t).fadeIn(88),JCck.DevHelper.setEdit2(l),e("#client label").removeClass("off"),JCck.DevHelper.ajaxLayer(JCck.Dev.name,"edit3","#sortable3",o,l)):"edit3"==i?(document.getElementById("sortable3").innerHTML=t,JCck.DevHelper.updateTrash("#sortable3"),JCck.DevHelper.ajaxLayer(JCck.Dev.name,"edit4","#sortable3",o,l)):"edit4"==i?(document.getElementById("sortable3").innerHTML=t,JCck.DevHelper.updateTrash("#sortable3")):(e("#loading").html(""),e(a).html(t),JCck.DevHelper.setEdit2(l))},error:function(){e(a).html("<div><strong>Oops!</strong> Try to close the page & re-open it properly.</div>")}})},ajaxTask:function(t,i,a,o){e("#task").val(t);var l=e("#"+e("#client .selected").attr("for")).val(),n=e("#"+e("#layer .selected").attr("for")).val(),s=e("#myid").val();e.ajax({cache:!1,data:e("#adminForm").serialize()+a,type:"POST",url:"index.php?option=com_cck&task="+t,beforeSend:function(){e("#loading").html(JCck.Dev.spinner),e(i).html(""),JCck.Dev.trash=""},success:function(t){e("#loading").html(""),e(i).hide().html(t).fadeIn(88),JCck.DevHelper.setEdit2(o),e("#client label").removeClass("off");var a=e("#myid").val(),s="id="+a+"&client="+l+"&layer="+n;JCck.DevHelper.ajaxLayer(JCck.Dev.name,"edit3","#sortable3",s,o)},error:function(){e(i).html("<div><strong>Oops!</strong> Try to close the page & re-open it properly.</div>")}})},doSubmit:function(){var t=e("#"+e("#client .selected").attr("for")).val();e("#layer label").removeClass("selected"),e("#layer input").removeAttr("checked"),e("#layer2").prop("checked",!0),JCck.DevHelper.preSubmit(),JCck.DevHelper.ajaxTask(JCck.Dev.name+".apply","#layers","&layout=edit2&brb=workshop&redirappend=client="+t+" layer=fields format=raw",JCck.Dev.uix),e("#layer2_label").addClass("selected")},getPane:function(){return e(".seblod-toolbar .panel.selected").html()-1},moveAcross:function(t){var i=e("li.ui-selected");if(t)i.appendTo(e(t)),JCck.DevHelper.switchP(-1,".ui-selected");else{var a=e('input:radio[name="positions"]:checked').attr("golast");a&&"undefined"!=a&&(e(a).before(i),JCck.DevHelper.switchP(JCck.DevHelper.getPane(),".ui-selected"))}JCck.DevHelper.unselect(i)},moveBottom:function(){var t=e("li.ui-selected"),i=e('input:radio[name="positions"]:checked').attr("golast");i&&"undefined"!=i&&(e(i).before(t),JCck.DevHelper.unselect(t))},move:function(t,i){var a=e("#"+t),o=a.parent().attr("id");if("1"==o[o.length-1])o="#"+o.substr(0,o.length-1)+"2",e(o).children().length?e(o).children().first().before(a):a.appendTo(e(o)),JCck.DevHelper.switchP(-1,t);else{var l=e('input:radio[name="positions"]:checked').attr("golast");l&&"undefined"!=l&&(e(l).before(a),JCck.DevHelper.switchP(JCck.DevHelper.getPane(),t))}JCck.DevHelper.unselect(a)},moveTop:function(){var t=e("li.ui-selected"),i=e('input:radio[name="positions"]:checked').attr("gofirst");i&&"undefined"!=i&&(e(i).after(t),JCck.DevHelper.unselect(t))},preSubmit:function(){e("#sortable2").remove()},previewPositions:function(){var t=e("#template").val();if(t){var i=JCck.Dev.root+"templates/"+e("#template").val()+"/template_preview.png",a="index.php?option=com_cck&task=box.add&tmpl=component&file="+i;e.colorbox({href:a,iframe:!0,innerWidth:850,innerHeight:585,scrolling:!1,overlayClose:!1,fixed:!0,onLoad:function(){e("#cboxClose").remove()}})}},setEdit2:function(t){var i=JCck.Dev.sb_inner;if(i){var a=e(window).height();e("#scroll").height(a-i)}e(window).scroll(function(){var t=e("#seblod-sidebar"),i=e(window).scrollTop(),a=t.length?t.offset().top:0;i>a?JCck.DevHelper.setSidebar():"fixed"==e("#seblod-sideblock").css("position")&&(e("#seblod-sideblock").css({position:"relative"}),e("#seblod-sideblock").css({top:"0px"}))}),e("#sortable1").parent().css({overflow:"visible"}),e("#sortable2").parent().parent().css({overflow:"visible"}),e("#pos-1").addClass("boundary");var o="compact"==t?"#sortable1":"#sortable1, #sortable2";e(o).sortable({cancel:"input,.ui-state-disabled",containment:"document",connectWith:".connected",items:"li:not(.boundary)",handle:".drag",placeholder:"drop-highlight",scroll:!0,forceHelperSize:!0,start:function(e,t){JCck.DevHelper.switchP(-1,t.item.attr("id")),t.item.css({top:"0",left:"0"})},stop:function(e,t){var i=t.item.parent().attr("myid");1==i?JCck.DevHelper.switchP(JCck.DevHelper.getPane(),t.item.attr("id")):JCck.DevHelper.switchP(-1,t.item.attr("id")),t.item.css({top:"0",left:"0"})}}),e("#sortable1, #sortable2").selectable({filter:"li.field",cancel:"input,img,option,select,span.c_live,span.c_live2,span.c_mat,span.c_mat2,span.c_val,span.c_typo,span.c_link,span.c_res,span.c_comp,span.c_cond,.cbox,.ui-state-disabled,span.c_cancelled,.sp2se,.se2sp"}),e(".wysiwyg_editor_box").colorbox({iframe:!0,innerWidth:820,innerHeight:420,scrolling:!1,overlayClose:!1,fixed:!0,onLoad:function(){e("#cboxClose").remove()}}),e("#options_redirection_itemid").isVisibleWhen("options_redirection","content"),e("#options_redirection_url").isVisibleWhen("options_redirection","url"),e("#options_redirection_url_no_access").isVisibleWhen("options_action_no_access","redirection")},setSidebar:function(){var t=e("#seblod-sideblock").width(),i=e(window).scrollTop(),a=e("#seblod-main").height(),o=e("#seblod-sideblock").height();if(o>a)e("#seblod-sidebar").hasClass("active")&&(e("#seblod-sidebar").removeClass("active"),e("#seblod-sidebar").addClass("passive"));else{var l=e("#seblod-sidebar"),n=l.length?l.offset().top:0;if(i>n){var s=e("#seblod-main").offset();if("fixed"!=e("#seblod-sideblock").css("position")&&(e("#seblod-sideblock").css({position:"fixed"}),e("#seblod-sideblock").css({width:t})),i+o>a+s.top-10){var r=e(document).height(),c=e("#seblod-cleaner").offset(),d=r-c.top;e("#seblod-sideblock").css({top:""}),e("#seblod-sideblock").css({bottom:d+"px"})}else e("#seblod-sideblock").css({top:JCck.Dev.sb_top+"px"}),e("#seblod-sideblock").css({bottom:""})}}},submit:function(e){Joomla.submitbutton(e)},switchP:function(t,i){var a=JCck.Dev.count;if(elem2=i?"."==i[0]?i+" ":"#"+i+" ":"#seblod-main ",i=i?"."==i[0]?i+" ":"#"+i+" ":"#sortable1 ",-1==t)for(var o=0;a>o;o++){var l=o+1;e(i+".p"+l)&&e(i+".p"+l).addClass("hide")}else if(-2==t)e(i+".p1").removeClass("hide"),e(i+".p2").removeClass("hide");else for(var o=0;a>o;o++){var l=o+1;o==t?(e(i+".p"+l).removeClass("hide"),e(elem2+".ph"+l).removeClass("hide")):(e(i+".p"+l)&&e(i+".p"+l).addClass("hide"),e(elem2+".ph"+l)&&e(elem2+".ph"+l).addClass("hide"))}},switchDisplay:function(t){var a=e(t).attr("data-cck_client_item");if(a&&(a=a.replace(/"/g,""))){var o=a.split(","),l=o.length,n=e(t).val(),s=e("#params_cck_client_item");if(s.length)for(i=0;i<l;i++){var r=o[i].split("=");if(n==r[0]){s.val(r[1]);break}}}},switchPos:function(){e("ul.sortable_header .ph11").hasClass("hide")?e("ul.sortable_header .ph11").removeClass("hide"):e("ul.sortable_header .ph11").addClass("hide"),e("#sortable1 .la").toggle(),e("#sortable1 .lb").toggle()},transliterateName:function(){if(e("span.insidebox").length>0)var t=e("span.insidebox").html()+"_";else var t="";var i=JCck.transliterate(t+e("#title").val(),JCck.Dev.transliteration);e("#name").val(i.toLowerCase().replace(/^\s+|\s+$/g,"").replace(/\s/g,"_").replace(/[^a-z0-9_]/gi,""))},unselect:function(e){e.hasClass("ui-selected")&&e.removeClass("ui-selected",600)},update:function(t,i,a){var o=t.parent(),l=t.attr("data-"+a);if("restriction"==i)e("#"+l+"_options").val(""),""!=e("#"+l).val()?e(o).find(".c_res").removeClass("hidden"):e(o).find(".c_res").addClass("hidden");else if("live"==i){var o=t.parents().eq(3);e("#"+l+"_options").val(""),""!=e("#"+l).val()?(e(o).find(".c_live0").addClass("hide"),e(o).find(".c_live").removeClass("show").addClass("hide"),e(o).find(".c_live2").removeClass("hide")):(e(o).find(".c_live0").removeClass("hide"),e(o).find(".c_live").removeClass("hide").addClass("show"),e(o).find(".c_live2").addClass("hide"))}else"typo"==i?(e("#"+l+"_options").val(""),""!=e("#"+l).val()?e(o).find(".c_typo").removeClass("hidden"):e(o).find(".c_typo").addClass("hidden")):"link"==i?(e("#"+l+"_options").val(""),""!=e("#"+l).val()?e(o).find(".c_link").removeClass("hidden"):e(o).find(".c_link").addClass("hidden")):"match_mode"==i&&("none"!=e("#"+l).val()?e(o).find(".c_mat").removeClass("hidden"):e(o).find(".c_mat").addClass("hidden"))},updateTrash:function(t){JCck.Dev.trash&&e(t).prepend(JCck.Dev.trash),JCck.Dev.trash=e(t+" li").detach(),e(t+" select").each(function(t){e("#layer_fields_options #"+e(this).attr("id")).length||e(this).appendTo("#layer_fields_options")})}},e(document).ready(function(){var t=e("#"+e("#client .selected").attr("for")).val(),i=e("#"+e("#layer .selected").attr("for")).val();JCck.Dev.block_item&&(e("#client5_label").addClass("disabled"),e("#client5").prop("disabled",!0),"item"==t&&(t="list",e("#client4_label").addClass("selected"),e("#client5_label").removeClass("selected")));var a=e("#name").val();e("#client label").addClass("off"),e.cookie("cck_"+JCck.Dev.name+a+"_client",t);var o=e("#myid").val(),l="id="+o+"&client="+t+"&layer="+i+JCck.Dev.skip;JCck.DevHelper.ajaxLayer(JCck.Dev.name,"edit2","#layers",l,JCck.Dev.uix),e("fieldset#client").on("click","label",function(){if(e("#title").validationEngine("validate")===!1&&e("#"+e(this).attr("for")).prop("disabled")!==!0&&!e(this).hasClass("off")&&!e(this).hasClass("selected")){a=e("#name").val(),e("#client label").addClass("off"),e("#client label").removeClass("selected"),e(this).addClass("selected");var t=e("#"+e(this).attr("for")).val(),i=e("#"+e("#layer .selected").attr("for")).val();e.cookie("cck_"+JCck.Dev.name+a+"_client",t);e("#myid").val();JCck.DevHelper.preSubmit(),JCck.DevHelper.ajaxTask(JCck.Dev.name+".apply","#layers","&layout=edit2&brb=workshop&redirappend=client="+t+" layer="+i+" format=raw",JCck.Dev.uix),e("#client input").removeAttr("checked"),e("#"+e(this).attr("for")).attr("checked","checked")}}),JCck.Dev.insidebox&&e("#title").after(JCck.Dev.insidebox),e("div#layers").on("change","select.filter",function(){JCck.Dev.trash&&e("#sortable2").append(JCck.Dev.trash);for(var t="",i=1;4>=i;i++){var a=e("#filter"+i).attr("prefix"),o=e("#filter"+i).val(),l=o?",#sortable2 li:not(."+a+o+")":"";t+=l}JCck.Dev.trash=e(t.substr(1)).hide().detach(),e("#sortable2 li").show()}),e("div#layers").on("click","a.panel",function(){var t=e(this).html();parseInt(t)>0?(e(".seblod-toolbar .panel").removeClass("selected"),e(this).addClass("selected"),JCck.DevHelper.switchP(t-1)):JCck.DevHelper.switchPos()}),e("div#layers").on("click","span.c_live",function(){var t=e(this).attr("name");if("type"==JCck.Dev.name)var i="none";else var i=e("#"+t+"_live").val();var a="index.php?option=com_cck&task=box.add&tmpl=component&file=administrator/components/com_cck/views/field/tmpl/selection.php&title="+JCck.Dev.name+"&name="+t+"&type="+t+"_live_value&id="+i;e.colorbox({href:a,iframe:!0,innerWidth:300,innerHeight:200,scrolling:!1,overlayClose:!1,fixed:!0,onLoad:function(){e("#cboxClose").remove()}})}),e("div#layers").on("click","span.c_live2",function(){var t=e(this).attr("name"),i=e("#"+t+"_live").val();if(i){if("stage"==i)var a="index.php?option=com_cck&task=box.add&tmpl=component&file=administrator/components/com_cck/helpers/scripts/stage.php&id="+t+"&validation=1";else var a="index.php?option=com_cck&task=box.add&tmpl=component&file=plugins/cck_field_live/"+i+"/tmpl/edit.php&id="+t+"&name="+i+"&validation=1";e.colorbox({href:a,iframe:!0,innerWidth:930,innerHeight:550,overlayClose:!1,fixed:!0,onLoad:function(){e("#cboxClose").remove()}})}}),e("div#layers").on("change","select.c_var_ck",function(){var t=e(this).parents().eq(3).attr("id");""!=this.value?e("#"+t+" .c_var").removeClass("hidden"):e("#"+t+" .c_var").addClass("hidden")}),e("div#layers").on("click","span.c_var",function(){var t=e(this).attr("name"),i=e("#pos-"+t+"_variation").val();if(i){var a="index.php?option=com_cck&task=box.add&tmpl=component&file=libraries/cck/rendering/variations/edit.php&id="+t+"&name="+i+"&type="+e("#template").val();e.colorbox({href:a,iframe:!0,innerWidth:930,innerHeight:550,overlayClose:!1,fixed:!0,onLoad:function(){e("#cboxClose").remove()}})}}),e("div#layers").on("contextmenu","span.c_val",function(){var t=e(this).attr("name"),i=e("#"+t+"_validation").val()?" + 1":"";return e("#"+t+"_required").val()?(e(this).html(Joomla.JText._("COM_CCK_OPTIONAL")+i),e("#"+t+"_required").val("")):(e(this).html(Joomla.JText._("COM_CCK_REQUIRED")+i),e("#"+t+"_required").val("required")),!1}),e("div#layers").on("click","span.c_val",function(){var t=e(this).attr("name"),i=e("#"+t+"_validation").val(),a="index.php?option=com_cck&task=box.add&tmpl=component&file=administrator/components/com_cck/helpers/scripts/validation.php&type="+JCck.Dev.name+"&id="+t+"&name="+i+"&validation=1";e.colorbox({href:a,iframe:!0,innerWidth:930,innerHeight:550,overlayClose:!1,fixed:!0,onLoad:function(){e("#cboxClose").remove()}})}),e("div#layers").on("click","span.c_typo",function(){var t=e(this).attr("name"),i=e("#"+t+"_typo").val();if(i){var a="index.php?option=com_cck&task=box.add&tmpl=component&file=plugins/cck_field_typo/"+i+"/tmpl/edit.php&id="+t+"&name="+i+"&validation=1";e.colorbox({href:a,iframe:!0,innerWidth:930,innerHeight:550,overlayClose:!1,fixed:!0,onLoad:function(){e("#cboxClose").remove()}})}}),e("div#layers").on("click","span.c_link",function(){var t=e(this).attr("name"),i=e("#"+t+"_link").val();if(i){var a="index.php?option=com_cck&task=box.add&tmpl=component&file=plugins/cck_field_link/"+i+"/tmpl/edit.php&id="+t+"&name="+i+"&validation=1";e.colorbox({href:a,iframe:!0,innerWidth:930,innerHeight:550,overlayClose:!1,fixed:!0,onLoad:function(){e("#cboxClose").remove()}})}}),e("div#layers").on("click","span.c_res",function(){var t=e(this).attr("name"),i=e("#"+t+"_restriction").val();if(i){var a="index.php?option=com_cck&task=box.add&tmpl=component&file=plugins/cck_field_restriction/"+i+"/tmpl/edit.php&id="+t+"&name="+i+"&validation=1";e.colorbox({href:a,iframe:!0,innerWidth:930,innerHeight:550,overlayClose:!1,fixed:!0,onLoad:function(){e("#cboxClose").remove()}})}}),e("div#layers").on("click","span.c_mat",function(){var t=e("#jform_id").val(),i=e(this).attr("name"),a=(e("#"+i+"_match_mode").val(),"index.php?option=com_cck&task=box.add&tmpl=component&file=administrator/components/com_cck/helpers/scripts/match.php&id="+t+"&name="+i+"&validation=1");e.colorbox({href:a,iframe:!0,innerWidth:930,innerHeight:550,overlayClose:!1,fixed:!0,onLoad:function(){e("#cboxClose").remove()}})}),e("div#layers").on("click","span.c_mat2",function(){var t=e("#jform_id").val(),i=e(this).attr("name"),a="index.php?option=com_cck&task=box.add&tmpl=component&file=administrator/components/com_cck/helpers/scripts/ordering.php&id="+t+"&name="+i+"&validation=1";e.colorbox({href:a,iframe:!0,innerWidth:930,innerHeight:550,overlayClose:!1,fixed:!0,onLoad:function(){e("#cboxClose").remove()}})}),e("div#layers").on("click","span.c_comp",function(){var t=e("#jform_id").val(),i=e(this).attr("name"),a=e("#ffp_"+i+"_computation").val();a=a.replace(/#/gi,"");var o="index.php?option=com_cck&task=box.add&tmpl=component&file=administrator/components/com_cck/helpers/scripts/computation.php&id="+t+"&type=type&name="+i+"&title="+a;e.colorbox({href:o,iframe:!0,innerWidth:930,innerHeight:550,overlayClose:!1,fixed:!0,onLoad:function(){e("#cboxClose").remove()}})}),e("div#layers").on("change",".se2sp",function(){var t=e(this).attr("id"),i=e(this).attr("data-to"),a=e(this).val(),o=e("#"+t+" option:selected").text();"variation"==e(this).attr("data-type")&&(o=o.replace(" (*)",'<span class="icon-key"></span>')),e("#"+i).val(a),e(this).parent().find('[data-id="'+i+'"]').html(o),JCck.DevHelper.update(e(this),e(this).attr("data-type"),"to"),e(this).trigger("mouseleave")}),e("div#layers").on("mouseleave",".se2sp",function(t){if(void 0!==t.fromElement||null!==t.relatedTarget){var i=e(this).attr("data-to");e(this).parent().find('[data-id="'+i+'"]').removeClass("hide"),e(this).remove()}}),e("div#layers").on("click",".sp2se",function(){var t=e(this).attr("data-id"),i=e(this).attr("data-to"),a=i.split("-"),o="_wk_"+i,l=e("#"+t).val();e(this).addClass("hide");var n=e("#"+o).clone(),s=n.html();"variation"==a[0]&&n.html(s.replace(new RegExp('&lt;span class="icon-key"&gt;&lt;/span&gt;',"g")," (*)")),n.attr("id",t+"_cur").val(l).addClass("se2sp").attr("data-to",t).prependTo(e(this).parent()).removeClass("hide").triggersDropdown()}),e("div#layers").on("contextmenu",".sp2se",function(){var t=e(this).attr("data-id"),i="_wk_"+e(this).attr("data-to");e("#"+i).val();e("#"+i).val(e("#"+t).val());var a=e("#"+i+" option:selected"),o=a.next();return o.length||(o=a.parent(),o=o.is("optgroup")?o.next():a.next()),o.is("optgroup")&&(o=o.children().first()),o.length||(o=e("#"+i+" option:first")),e("#"+t).val(o.val()),e(this).html(o.text()),JCck.DevHelper.update(e(this),e(this).attr("data-to"),"id"),!1}),e("div#layers").on("click","span.c_cond",function(){var t=e("#jform_id").val(),i=e(this).attr("name"),a=e("#ffp_"+i+"_conditional_options").val();if(""!=a){var o=""!=a?e.parseJSON(a):"";a=void 0===o.length?1:o.length}else a=1;var l="index.php?option=com_cck&task=box.add&tmpl=component&file=administrator/components/com_cck/helpers/scripts/conditional.php&id="+t+"&type="+JCck.Dev.name+"&name="+i+"&title="+a;e.colorbox({href:l,iframe:!0,innerWidth:930,innerHeight:550,overlayClose:!1,fixed:!0,onLoad:function(){e("#cboxClose").remove()}})}),e("div#layers").on("click","a#linkage",function(){e("#linkage input").removeAttr("checked"),1==e("#linkage0").prop("checked")?(e("#linkage span").removeClass("unlinked").addClass("linked"),e("#linkage1").attr("checked","checked")):(e("#linkage span").removeClass("linked").addClass("unlinked"),e("#linkage0").attr("checked","checked"))}),e("#toggle_more").css({top:e("#toggle_more").parent().height()+12}),e("#toggle_more").live("click",function(){e("#toggle_more").hasClass("open")?e("#toggle_more").removeClass("open").addClass("closed"):e("#toggle_more").removeClass("closed").addClass("open"),e("#more").slideToggle(88)}),e("div#layers").on("click","a#initclient",function(){if(e("#sortable1").children(".field").length>0&&!confirm(Joomla.JText._("COM_CCK_GET_FIELDS_FROM_VIEW_CONFIRM")))return!1;var t=e("#"+e("#client .selected").attr("for")).val(),i="fields";e("#myid").val();e("#fromclient").val("1"),JCck.DevHelper.preSubmit(),JCck.DevHelper.ajaxTask("type.apply","#layers","&layout=edit2&brb=workshop&redirappend=client="+t+" layer="+i+" format=raw",JCck.Dev.uix)}),e("div#layers").on("contextmenu","a.icon-add",function(){var t=e("ul#sortable1 li.ui-selected"),i=t.length;if(i>0){var a=[];e.each(t,function(){a.push(e(this).attr("id"))}),a=a.join();var o=window.prompt(JCck.Dev.prompt_group,"");null!=o&&""!=o&&JCck.DevHelper.ajaxAddType(o,a)}return!1})})}(jQuery);